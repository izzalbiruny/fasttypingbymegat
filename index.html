<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Typing Speed Game</title>
<style>
    :root {
        --bg: #f4f4f4;
        --text: #222;
        --accent: #0077ff;
        --error: #ff3b3b;
        --box: #fff;
    }
    body.dark {
        --bg: #1e1e1e;
        --text: #e0e0e0;
        --box: #2a2a2a;
    }
    body {
        margin: 0; padding: 0;
        background: var(--bg);
        color: var(--text);
        font-family: Arial, sans-serif;
        display: flex; flex-direction: column;
        align-items: center; justify-content: center;
        height: 100vh;
        transition: background .3s, color .3s;
    }
    h1 { margin-top: 0; }
    .controls, .info { margin: 10px 0; }
    select, button, input {
        padding: 5px 10px;
        margin: 0 5px;
    }
    #quoteBox {
        width: 80%;
        max-width: 600px;
        padding: 20px;
        margin-top: 20px;
        background: var(--box);
        border-radius: 8px;
        font-size: 1.4rem;
        min-height: 80px;
        text-align: center;
    }
    .char.correct { color: green; }
    .char.incorrect { color: var(--error); }
    #timer {
        font-size: 1.2rem;
        font-weight: bold;
    }
    .low-time { color: var(--error); }
    #resultBox { margin-top: 20px; font-size: 1.2rem; }
    #darkModeToggle {
        position: absolute; top: 15px; right: 15px;
    }
    /* hidden input for phone typing */
    #mobileInput {
        opacity: 0;
        position: absolute;
        pointer-events: none;
    }
</style>
</head>
<body>
<h1>Typing Speed Game</h1>

<div class="controls">
    <label>Theme:
        <select id="themeSelect">
            <option value="sea">Sea</option>
            <option value="house">In the House</option>
            <option value="supermarket">Supermarket</option>
            <option value="school">School</option>
        </select>
    </label>
    <label>Difficulty:
        <select id="difficultySelect">
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
        </select>
    </label>
    <label>Time:
        <input type="number" id="timeSelect" value="30" min="15" max="50">
    </label>
    <button id="startBtn">Start</button>
    <button id="darkModeToggle">Dark/Light</button>
</div>

<div class="info">
    <span id="timer">Timer: 0s</span> |
    <span id="wpm">WPM: 0</span>
</div>

<div id="quoteBox">Press Start to begin...</div>
<div id="resultBox"></div>

<!-- hidden input for mobile typing -->
<input id="mobileInput" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">

<script>
const startBtn = document.getElementById('startBtn');
const darkToggle = document.getElementById('darkModeToggle');
const quoteBox = document.getElementById('quoteBox');
const timerEl = document.getElementById('timer');
const wpmEl = document.getElementById('wpm');
const resultBox = document.getElementById('resultBox');
const themeSelect = document.getElementById('themeSelect');
const diffSelect = document.getElementById('difficultySelect');
const timeSelect = document.getElementById('timeSelect');
const mobileInput = document.getElementById('mobileInput');

darkToggle.addEventListener('click', ()=> document.body.classList.toggle('dark'));

const quotes = {
  sea: [
    "Waves crash gently on the shore.",
    "A lighthouse shines over the ocean.",
    "Fishermen cast their nets at dawn.",
    "The coral reef hides many secrets.",
    "A seagull soars above the blue sea."
  ],
  house: [
    "The cat sleeps on the warm sofa.",
    "A clock ticks quietly in the hall.",
    "The kettle whistles on the stove.",
    "Books are stacked neatly on the shelf.",
    "A breeze enters through the open window."
  ],
  supermarket: [
    "Apples are fresh in the basket.",
    "A cashier scans the items fast.",
    "Customers wait patiently in line.",
    "The bread smells warm and sweet.",
    "Frozen vegetables fill the freezer section."
  ],
  school: [
    "Students hurry to their classrooms.",
    "The teacher writes on the blackboard.",
    "Laughter echoes in the school hallway.",
    "Notebooks are scattered on the desk.",
    "The bell rings to signal recess."
  ]
};

let currentText = "";
let index = 0;
let timer = 0;
let interval = null;
let started = false;
let correctChars = 0;

function pickRandomQuote(theme) {
  const arr = quotes[theme];
  return arr[Math.floor(Math.random()*arr.length)];
}

function displayQuote(text) {
  quoteBox.innerHTML = "";
  for (let ch of text) {
    const span = document.createElement('span');
    span.textContent = ch;
    span.classList.add('char');
    quoteBox.appendChild(span);
  }
}

function startGame() {
  clearInterval(interval);
  started = false;
  index = 0;
  correctChars = 0;
  timer = parseInt(timeSelect.value);
  timerEl.textContent = `Timer: ${timer}s`;
  timerEl.classList.remove('low-time');
  resultBox.textContent = "";
  currentText = pickRandomQuote(themeSelect.value);
  displayQuote(currentText);
  wpmEl.textContent = "WPM: 0";
  mobileInput.focus(); // focus for phone keyboard
}

function startTimer() {
  if (!started) {
    started = true;
    interval = setInterval(()=>{
      timer--;
      timerEl.textContent = `Timer: ${timer}s`;
      if (timer <= 5) timerEl.classList.add('low-time');
      if (timer <= 0) endGame(false);
    },1000);
  }
}

function endGame(win) {
  clearInterval(interval);
  started = false;
  const wpm = Math.round(correctChars/5/((parseInt(timeSelect.value)-timer+1)/60));
  wpmEl.textContent = `WPM: ${wpm}`;
  resultBox.textContent = win ? "You Win! ðŸŽ‰" : "Time's Up! â³";
}

function handleInput(key) {
  startTimer();
  if (index >= currentText.length || timer <= 0) return;
  const spans = quoteBox.querySelectorAll('span');
  if (key === currentText[index]) {
    spans[index].classList.add('correct');
    index++;
    correctChars++;
    if (index === currentText.length) {
      endGame(true);
    }
  } else {
    spans[index].classList.add('incorrect');
    index++; // tak boleh delete, terus move
  }
}

// keyboard
document.addEventListener('keydown', e => {
  if (!started && /^[a-zA-Z0-9 ,.'!?]$/.test(e.key)) startTimer();
  if (e.key.length === 1) handleInput(e.key);
});

// phone hidden input
mobileInput.addEventListener('input', e=>{
  const val = e.target.value;
  if (val.length > 0) {
    const lastChar = val.slice(-1);
    handleInput(lastChar);
    e.target.value = '';
  }
});

startBtn.addEventListener('click', startGame);
</script>
</body>
</html>
